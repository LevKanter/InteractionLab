<!doctype html> 
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US"> 
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>	
	<title>Canvas 101</title>
	
	<style>
		body {
			background-color: #eeeeee;
		}
		
		canvas {
			display: block;
			margin: 30px auto;
			padding: 10px;
			border: 3px double #cccccc;
		}
		
	</style>
	
</head>
	
<body>
	
	<canvas id="sketch" width="600" height="480">
		<p>canvas not supported</p>
	</canvas>
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script>
		(function(window) {
	
			var frameRate = 1000/60,
			    looping = true,
		
			    canvas, // the canvas DOM element
			
			    $c, // a jQuery object that represents the canvas,
			        // useful if we want to bind events, etc
			
			    context, // the canvas's "graphics" context
			             // we will call functions on this object
			             // to render stuff on the canvas
			
			    width, // width of the canvas
			    height, // height of the canvas
			
			    mouseX = 0,
			    mouseY = 0,
			    pmouseX = 0,
			    pmouseY = 0,
			    mousePressed = false,
			
			    bg, // background color
			    fg; // foreground color
			
			function circle(x, y, r) {
				context.fillStyle = fg;
				context.beginPath();
				context.save();
				context.translate(x, y);
				context.arc(0, 0, r, 0, 2*Math.PI, true);
				context.restore();
				context.closePath();
				context.fill();
			}

			function cursor() {
				$c.css("cursor", "default");
			}

			function noCursor() {
				$c.css("cursor", "none");
			}
		
			function prepareCanvas(id) {

				var c = document.getElementById(id);
			
				if (!c) {
					// no element with the specified id
					return false;
				}

				if (typeof c.getContext !== "function") {
					// the browser does not support canvas
					return false;
				}
			
				canvas = c;

				context = canvas.getContext("2d");

				width = canvas.width;
				height = canvas.height;
				
				$c = $(canvas);

				$c
					.bind("mousemove", function(event) {

						pmouseX = mouseX;
						pmouseY = mouseY;
						mouseX = event.pageX - this.offsetLeft;
						mouseY = event.pageY - this.offsetTop;

					}).bind("mousedown", function() {

						mousePressed = true;
						mousePressedEvent();

					}).bind("mouseup", function() {

						mousePressed = false;
						mouseReleasedEvent();

					}).trigger("focus");
			
				return true;
			}
			
			function setup() {
				//noCursor();
				
				bg = "rgba(0, 150, 30, 1)";
				fg = "rgb(0, 0, 180)";
				
				context.fillStyle = bg;
				context.fillRect(0, 0, width, height);
			}
		
			function draw() {
				//context.clearRect(0, 0, width, height);
				
				if (mousePressed) {
					circle(mouseX, mouseY, 15);
				}
			}
		
			function mousePressedEvent() {
				console.info("mouse pressed!");
			}
		
			function mouseReleasedEvent() {
				console.info("mouse released!");
			}
		
			
		
			function loop() {
				draw();
				if (looping) {
					window.setTimeout(loop, frameRate);
				}
			}
			
			$(document).ready(function() {
				
				var id = "sketch";
				
				if ( prepareCanvas(id) ) {
					
					setup();
					loop();
					
					window.stop = function() {
						looping = false;
					};

					window.start = function() {
						looping = true;
						loop();
					};
					
				} else {
					console.warn("there was a problem initializing the canvas");
				}
			});
			
		}(this));
		
	</script>
</body>
</html>